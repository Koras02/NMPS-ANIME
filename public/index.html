<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Anime Search</title>
    <style>
      img {
        width: 100px;
      }
      .anime {
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>애니 검색</h1>
    <input type="text" id="query" placeholder="애니 이름" />
    <button onclick="searchAnime()">검색</button>

    <h2>검색 결과</h2>
    <div id="results"></div>

    <h2>좋아요 리스트</h2>
    <div id="likes"></div>

    <script>
      async function searchAnime() {
        const q = document.getElementById("query").value;
        const res = await fetch(`/api/search?q=${q}`);
        const data = await res.json();
        const container = document.getElementById("results");
        container.innerHTML = "";
        data.forEach((a) => {
          console.log(a.mal_id);

          const div = document.createElement("div");
          div.className = "anime";
          div.innerHTML = `
      <img src="${a.img_url}" />
      <strong>${a.title}</strong> (${a.score})
      <button onclick="likeAnime(${a.mal_id})">❤️ 좋아요</button>
    `;
          container.appendChild(div);
        });
      }

      async function likeAnime(mal_id) {
        await fetch(`/api/animes/${mal_id}/like`, { method: "POST" });
        alert("좋아요 등록!");
        getLikes();
      }

      async function getLikes() {
        const res = await fetch("/api/user/me/likes");
        const data = await res.json();
        const container = document.getElementById("likes");
        container.innerHTML = "";
        data.forEach((a) => {
          const div = document.createElement("div");
          div.innerHTML = `
           <img src="${a.img_url || ""}" />
           <strong>${a.title}</strong>(${a.score || "N/A"})
          `;
          container.appendChild(div);
        });
      }

      // 페이지 로딩 시 좋아요 리스트 표시
      getLikes();
    </script>
  </body>
</html>
